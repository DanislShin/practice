<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>English Active Tenses Practice</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    :root {
      --present: #4285f4;
      --past: #ea4335;
      --future: #34a853;
      --continuous: #673ab7;
      --perfect: #fbbc05;
    }
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      line-height: 1.7;
      color: #333;
    }
    h1, h2 {
      color: #202124;
      border-bottom: 2px solid #4285f4;
      padding-bottom: 10px;
    }
    h2 { margin-top: 30px; }
    button {
      margin: 5px 5px 10px 0;
      padding: 8px 15px;
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .tense-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 25px;
    }
    .usage {
      margin: 20px 0;
      padding-left: 15px;
      border-left: 3px solid #ddd;
    }
    .sentence-block {
      padding: 15px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      background: white;
      margin: 10px 0;
      position: relative;
    }
    .tense-label {
      display: inline-block;
      padding: 4px 10px;
      background: var(--tense-color);
      color: white;
      border-radius: 4px;
      font-size: 0.85em;
      font-weight: bold;
      margin-right: 8px;
    }
    .form-label {
      display: inline-block;
      padding: 4px 8px;
      background: #5f6368;
      color: white;
      border-radius: 4px;
      font-size: 0.75em;
    }
    audio { 
      display: block;
      margin: 12px 0;
      width: 100%;
    }
    .translation {
      margin-top: 10px;
      padding: 10px;
      background: #e8f0fe;
      border-radius: 4px;
    }
    .hidden { display: none; }
    .checkmark {
      position: absolute;
      right: 15px;
      top: 15px;
      color: #34a853;
      font-size: 20px;
    }
    .warning {
      background-color: #fff3cd;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #ffc107;
    }
    .error-message {
      color: #d32f2f;
      background-color: #fde7e9;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>English Active Tenses Practice</h1>
  
  <div class="warning">
    <strong>ì‚¬ìš© ì•ˆë‚´:</strong> 
    <p>- ì´ í˜ì´ì§€ëŠ” Chrome ë¸Œë¼ìš°ì €ì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
    <p>- ìŒì„± ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ ì§ì ‘ ì½ì–´ë³´ì„¸ìš”.</p>
    <p>- ë…¹ìŒ ê¸°ëŠ¥ ì‚¬ìš© ì‹œ ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.</p>
  </div>
  
  <button onclick="downloadAllRecordings()">ğŸ“¥ Download All Recordings</button>
  <div id="content"></div>
  <div id="error-container" class="error-message hidden"></div>

  <script>
    // ì˜¤ë¥˜ í‘œì‹œ í•¨ìˆ˜
    function showError(message) {
      const errorContainer = document.getElementById('error-container');
      errorContainer.textContent = message;
      errorContainer.classList.remove('hidden');
      console.error(message);
    }

    // ë¬¸ë²• ë°ì´í„°
    const grammarData = [
      // ======= ë‹¨ìˆœ í˜„ì¬ (Simple Present) =======
      {
        tense: "Simple Present",
        color: "var(--present)",
        usages: [
          {
            title: "ìš©ë²• 1: í˜„ì¬ì˜ ìƒíƒœ (ì†Œìœ , ê°ì •, ìƒê°, ì¡´ì¬)",
            examples: [
              { en: "I have a car.", ko: "ë‚˜ëŠ” ì°¨ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "I don't have a car.", ko: "ë‚˜ëŠ” ì°¨ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Do you have a car?", ko: "ë„ˆ ì°¨ ê°€ì§€ê³  ìˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Don't you have a car?", ko: "ë„ˆ ì°¨ ì•ˆ ê°€ì§€ê³  ìˆì–´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 2: ìŠµê´€ì´ë‚˜ ì¼ìƒ (ë°˜ë³µë˜ëŠ” í–‰ë™)",
            examples: [
              { en: "He goes to school every day.", ko: "ê·¸ëŠ” ë§¤ì¼ í•™êµì— ê°€ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "He doesn't go to school every day.", ko: "ê·¸ëŠ” ë§¤ì¼ í•™êµì— ê°€ì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Does he go to school every day?", ko: "ê·¸ê°€ ë§¤ì¼ í•™êµì— ê°€?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Doesn't he go to school every day?", ko: "ê·¸ê°€ ë§¤ì¼ í•™êµì— ì•ˆ ê°€?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 3: ì¼ë°˜ì ì¸ ì‚¬ì‹¤ì´ë‚˜ ì§„ë¦¬",
            examples: [
              { en: "The sun rises in the east.", ko: "í•´ëŠ” ë™ìª½ì—ì„œ ë– ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "The sun doesn't rise in the west.", ko: "í•´ëŠ” ì„œìª½ì—ì„œ ëœ¨ì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Does the sun rise in the east?", ko: "í•´ê°€ ë™ìª½ì—ì„œ ë– ?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Doesn't the sun rise in the east?", ko: "í•´ê°€ ë™ìª½ì—ì„œ ì•ˆ ë– ?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 4: ê°ì •, ì˜ê²¬, ìƒíƒœ (í˜„ì¬ì˜ ëŠë‚Œì´ë‚˜ ìƒê°)",
            examples: [
              { en: "I think you're right.", ko: "ë‚˜ëŠ” ë„ˆê°€ ë§ë‹¤ê³  ìƒê°í•´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "I don't think you're right.", ko: "ë‚˜ëŠ” ë„ˆê°€ ë§ë‹¤ê³  ìƒê°í•˜ì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Do you think I'm right?", ko: "ë„ˆ ë‚´ê°€ ë§ë‹¤ê³  ìƒê°í•´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Don't you think I'm right?", ko: "ë„ˆ ë‚´ê°€ ë§ë‹¤ê³  ìƒê° ì•ˆ í•´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 5: ì¼ì •ì´ë‚˜ ì‹œê°„í‘œ (ì •í•´ì§„ ìŠ¤ì¼€ì¤„)",
            examples: [
              { en: "The train leaves at 6 PM.", ko: "ê¸°ì°¨ëŠ” ì˜¤í›„ 6ì‹œì— ë– ë‚˜ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "The train doesn't leave at 6 PM.", ko: "ê¸°ì°¨ëŠ” ì˜¤í›„ 6ì‹œì— ë– ë‚˜ì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Does the train leave at 6 PM?", ko: "ê¸°ì°¨ê°€ ì˜¤í›„ 6ì‹œì— ë– ë‚˜?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Doesn't the train leave at 6 PM?", ko: "ê¸°ì°¨ê°€ ì˜¤í›„ 6ì‹œì— ì•ˆ ë– ë‚˜?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          }
        ]
      },

      // ======= ë‹¨ìˆœ ê³¼ê±° (Simple Past) =======
      {
        tense: "Simple Past",
        color: "var(--past)",
        usages: [
          {
            title: "ìš©ë²• 1: ê³¼ê±°ì— ì™„ë£Œëœ íŠ¹ì • ì‚¬ê±´",
            examples: [
              { en: "She visited her grandma last weekend.", ko: "ê·¸ë…€ëŠ” ì§€ë‚œ ì£¼ë§ì— í• ë¨¸ë‹ˆë¥¼ ë°©ë¬¸í–ˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "She didn't visit her grandma last weekend.", ko: "ê·¸ë…€ëŠ” ì§€ë‚œ ì£¼ë§ì— í• ë¨¸ë‹ˆë¥¼ ë°©ë¬¸í•˜ì§€ ì•Šì•˜ì–´ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Did she visit her grandma last weekend?", ko: "ê·¸ë…€ê°€ ì§€ë‚œ ì£¼ë§ì— í• ë¨¸ë‹ˆë¥¼ ë°©ë¬¸í–ˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Didn't she visit her grandma last weekend?", ko: "ê·¸ë…€ê°€ ì§€ë‚œ ì£¼ë§ì— í• ë¨¸ë‹ˆë¥¼ ë°©ë¬¸í•˜ì§€ ì•Šì•˜ì–´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          }
        ]
      },

      // ======= ë‹¨ìˆœ ë¯¸ë˜ (Simple Future) =======
      {
        tense: "Simple Future",
        color: "var(--future)",
        usages: [
          {
            title: "ìš©ë²• 1: ë¯¸ë˜ì˜ ê³„íšì´ë‚˜ ì˜ˆì¸¡",
            examples: [
              { en: "We will travel to Busan next month.", ko: "ìš°ë¦¬ëŠ” ë‹¤ìŒ ë‹¬ì— ë¶€ì‚°ì— ì—¬í–‰ ê°ˆ ê±°ì˜ˆìš”.", form: "ê¸ì •ë¬¸" },
              { en: "We won't travel to Busan next month.", ko: "ìš°ë¦¬ëŠ” ë‹¤ìŒ ë‹¬ì— ë¶€ì‚°ì— ì—¬í–‰ ê°€ì§€ ì•Šì„ ê±°ì˜ˆìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Will you travel to Busan next month?", ko: "ë„ˆ ë‹¤ìŒ ë‹¬ì— ë¶€ì‚°ì— ì—¬í–‰ ê°ˆ ê±°ì•¼?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Won't you travel to Busan next month?", ko: "ë„ˆ ë‹¤ìŒ ë‹¬ì— ë¶€ì‚°ì— ì—¬í–‰ ì•ˆ ê°ˆ ê±°ì•¼?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 2: ì¦‰í¥ì ì¸ ê²°ì •",
            examples: [
              { en: "I will call you later.", ko: "ë‚˜ì¤‘ì— ë„ˆí•œí…Œ ì „í™”í• ê²Œìš”.", form: "ê¸ì •ë¬¸" },
              { en: "I won't call you later.", ko: "ë‚˜ì¤‘ì— ë„ˆí•œí…Œ ì „í™” ì•ˆ í• ê²Œìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Will you call me later?", ko: "ë‚˜ì¤‘ì— ë‚˜í•œí…Œ ì „í™”í•  ê±°ì•¼?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Won't you call me later?", ko: "ë‚˜ì¤‘ì— ë‚˜í•œí…Œ ì „í™” ì•ˆ í•  ê±°ì•¼?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          }
        ]
      },

      // ======= í˜„ì¬ ì§„í–‰ (Present Continuous) =======
      {
        tense: "Present Continuous",
        color: "var(--continuous)",
        usages: [
          {
            title: "ìš©ë²• 1: ì§€ê¸ˆ ì´ ìˆœê°„ ì§„í–‰ ì¤‘ì¸ ì¼",
            examples: [
              { en: "He is studying English right now.", ko: "ê·¸ëŠ” ì§€ê¸ˆ ì˜ì–´ë¥¼ ê³µë¶€í•˜ê³  ìˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "He isn't studying English right now.", ko: "ê·¸ëŠ” ì§€ê¸ˆ ì˜ì–´ë¥¼ ê³µë¶€í•˜ê³  ìˆì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Is he studying English right now?", ko: "ê·¸ê°€ ì§€ê¸ˆ ì˜ì–´ë¥¼ ê³µë¶€í•˜ê³  ìˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Isn't he studying English right now?", ko: "ê·¸ê°€ ì§€ê¸ˆ ì˜ì–´ë¥¼ ê³µë¶€í•˜ê³  ìˆì§€ ì•Šì•„?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 2: í˜„ì¬ ì‹œì ì˜ ì¼ì‹œì ì¸ í–‰ë™",
            examples: [
              { en: "She is staying at a hotel this week.", ko: "ê·¸ë…€ëŠ” ì´ë²ˆ ì£¼ì— í˜¸í…”ì— ë¬µê³  ìˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "She isn't staying at a hotel this week.", ko: "ê·¸ë…€ëŠ” ì´ë²ˆ ì£¼ì— í˜¸í…”ì— ë¬µê³  ìˆì§€ ì•Šì•„ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Is she staying at a hotel this week?", ko: "ê·¸ë…€ê°€ ì´ë²ˆ ì£¼ì— í˜¸í…”ì— ë¬µê³  ìˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Isn't she staying at a hotel this week?", ko: "ê·¸ë…€ê°€ ì´ë²ˆ ì£¼ì— í˜¸í…”ì— ë¬µê³  ìˆì§€ ì•Šì•„?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 3: ë¯¸ë˜ì˜ ì˜ˆì •ëœ ì¼ì´ë‚˜ ìŠ¤ì¼€ì¤„",
            examples: [
              { en: "She is meeting her friend tomorrow.", ko: "ê·¸ë…€ëŠ” ë‚´ì¼ ì¹œêµ¬ë¥¼ ë§Œë‚  ê±°ì˜ˆìš”.", form: "ê¸ì •ë¬¸" },
              { en: "She isn't meeting her friend tomorrow.", ko: "ê·¸ë…€ëŠ” ë‚´ì¼ ì¹œêµ¬ë¥¼ ë§Œë‚˜ì§€ ì•Šì„ ê±°ì˜ˆìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Is she meeting her friend tomorrow?", ko: "ê·¸ë…€ê°€ ë‚´ì¼ ì¹œêµ¬ë¥¼ ë§Œë‚  ê±°ì•¼?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Isn't she meeting her friend tomorrow?", ko: "ê·¸ë…€ê°€ ë‚´ì¼ ì¹œêµ¬ë¥¼ ì•ˆ ë§Œë‚  ê±°ì•¼?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          }
        ]
      },

      // ======= ê³¼ê±° ì§„í–‰ (Past Continuous) =======
      {
        tense: "Past Continuous",
        color: "var(--continuous)",
        usages: [
          {
            title: "ìš©ë²• 1: ê³¼ê±° íŠ¹ì • ì‹œì ì— ì§„í–‰ ì¤‘ì´ë˜ ì¼",
            examples: [
              { en: "They were watching TV when I called.", ko: "ê·¸ë“¤ì€ ë‚´ê°€ ì „í™”í–ˆì„ ë•Œ TVë¥¼ ë³´ê³  ìˆì—ˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "They weren't watching TV when I called.", ko: "ê·¸ë“¤ì€ ë‚´ê°€ ì „í™”í–ˆì„ ë•Œ TVë¥¼ ë³´ê³  ìˆì§€ ì•Šì•˜ì–´ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Were they watching TV when I called?", ko: "ê·¸ë“¤ì´ ë‚´ê°€ ì „í™”í–ˆì„ ë•Œ TVë¥¼ ë³´ê³  ìˆì—ˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Weren't they watching TV when I called?", ko: "ê·¸ë“¤ì´ ë‚´ê°€ ì „í™”í–ˆì„ ë•Œ TVë¥¼ ë³´ê³  ìˆì§€ ì•Šì•˜ì–´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          }
        ]
      },

      // ======= í˜„ì¬ ì™„ë£Œ (Present Perfect) =======
      {
        tense: "Present Perfect",
        color: "var(--perfect)",
        usages: [
          {
            title: "ìš©ë²• 1: ê³¼ê±°ë¶€í„° í˜„ì¬ê¹Œì§€ ì´ì–´ì§„ ê²½í—˜",
            examples: [
              { en: "I have visited Paris three times.", ko: "ë‚˜ëŠ” íŒŒë¦¬ë¥¼ ì„¸ ë²ˆ ë°©ë¬¸í–ˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "I haven't visited Paris three times.", ko: "ë‚˜ëŠ” íŒŒë¦¬ë¥¼ ì„¸ ë²ˆ ë°©ë¬¸í•˜ì§€ ì•Šì•˜ì–´ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Have you visited Paris three times?", ko: "ë„ˆ íŒŒë¦¬ë¥¼ ì„¸ ë²ˆ ë°©ë¬¸í–ˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Haven't you visited Paris three times?", ko: "ë„ˆ íŒŒë¦¬ë¥¼ ì„¸ ë²ˆ ë°©ë¬¸í•˜ì§€ ì•Šì•˜ì–´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 2: ë°©ê¸ˆ ëë‚œ ì¼",
            examples: [
              { en: "I have just finished my homework.", ko: "ë‚˜ëŠ” ë°©ê¸ˆ ìˆ™ì œë¥¼ ëëƒˆì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "I haven't just finished my homework.", ko: "ë‚˜ëŠ” ë°©ê¸ˆ ìˆ™ì œë¥¼ ëë‚´ì§€ ì•Šì•˜ì–´ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Have you just finished your homework?", ko: "ë„ˆ ë°©ê¸ˆ ìˆ™ì œ ëëƒˆì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Haven't you just finished your homework?", ko: "ë„ˆ ë°©ê¸ˆ ìˆ™ì œ ì•ˆ ëëƒˆì–´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          },
          {
            title: "ìš©ë²• 3: ê³¼ê±°ë¶€í„° í˜„ì¬ê¹Œì§€ì˜ ìƒíƒœ",
            examples: [
              { en: "We have lived here since 2020.", ko: "ìš°ë¦¬ëŠ” 2020ë…„ë¶€í„° ì—¬ê¸° ì‚´ì•„ì™”ì–´ìš”.", form: "ê¸ì •ë¬¸" },
              { en: "We haven't lived here since 2020.", ko: "ìš°ë¦¬ëŠ” 2020ë…„ë¶€í„° ì—¬ê¸° ì‚´ì§€ ì•Šì•˜ì–´ìš”.", form: "ë¶€ì •ë¬¸" },
              { en: "Have you lived here since 2020?", ko: "ë„ˆ 2020ë…„ë¶€í„° ì—¬ê¸° ì‚´ì•„ì™”ì–´?", form: "ì˜ë¬¸ë¬¸" },
              { en: "Haven't you lived here since 2020?", ko: "ë„ˆ 2020ë…„ë¶€í„° ì—¬ê¸° ì‚´ì§€ ì•Šì•˜ì–´?", form: "ë¶€ì •ì˜ë¬¸ë¬¸" }
            ]
          }
        ]
      }
    ];

    const audioBlobs = {};
    const mediaRecorders = {};
    let isSpeechSupported = false;

    // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', function() {
      try {
        // ìŒì„± í•©ì„± ì§€ì› ì—¬ë¶€ í™•ì¸
        isSpeechSupported = 'speechSynthesis' in window;
        
        // ì½˜í…ì¸  ë Œë”ë§
        renderContent();
        
        // ì˜¤ë¥˜ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
        document.getElementById('error-container').classList.add('hidden');
      } catch (error) {
        showError('í˜ì´ì§€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    });

    function renderContent() {
      const container = document.getElementById('content');
      
      grammarData.forEach((tenseData, tenseIndex) => {
        const tenseSection = document.createElement('div');
        tenseSection.className = 'tense-section';
        tenseSection.style.setProperty('--tense-color', tenseData.color);
        
        let tenseHTML = `
          <h2 style="border-color: ${tenseData.color}">
            <span class="tense-label" style="background: ${tenseData.color}">${tenseData.tense}</span>
          </h2>
        `;
        
        tenseData.usages.forEach((usage, usageIndex) => {
          tenseHTML += `
            <div class="usage">
              <h3>${usage.title}</h3>
          `;
          
          usage.examples.forEach((example, exampleIndex) => {
            const index = `${tenseIndex}-${usageIndex}-${exampleIndex}`;
            const escapedText = example.en.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            tenseHTML += `
              <div class="sentence-block">
                <span id="check-${index}" class="checkmark"></span>
                <div>
                  <span class="form-label">${example.form}</span>
                </div>
                <p><strong>${example.en}</strong></p>
                <div>
                  <button onclick="playTTS('${escapedText}')">â–¶ï¸ Listen</button>
                  <button onclick="startRecording(${tenseIndex}, ${usageIndex}, ${exampleIndex})">ğŸ™ï¸ Record</button>
                  <button onclick="stopRecording(${tenseIndex}, ${usageIndex}, ${exampleIndex})">â¹ï¸ Stop</button>
                  <button onclick="toggle('trans-${index}')">ğŸ” Translation</button>
                </div>
                <audio id="audio-${index}" controls></audio>
                <div id="trans-${index}" class="hidden translation">
                  <p><strong>Korean:</strong> ${example.ko}</p>
                </div>
              </div>
            `;
          });
          
          tenseHTML += `</div>`;
        });
        
        tenseSection.innerHTML = tenseHTML;
        container.appendChild(tenseSection);
      });
    }

    function playTTS(text) {
      if (!isSpeechSupported) {
        alert('ì´ ê¸°ê¸°ì—ì„œëŠ” ìŒì„± ì¬ìƒ ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ì ‘ ì½ì–´ ë³´ì„¸ìš”.');
        return;
      }
      
      try {
        // ìŒì„± ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€
        window.speechSynthesis.cancel();
        
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'en-US';
        utter.rate = 0.9;
        
        utter.onerror = function(event) {
          console.error('SpeechSynthesis error:', event);
          alert('ìŒì„± ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Chrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ ë³´ì„¸ìš”.');
        };
        
        window.speechSynthesis.speak(utter);
      } catch (error) {
        showError('ìŒì„± ì¬ìƒ ì˜¤ë¥˜: ' + error.message);
      }
    }

    async function startRecording(tenseIndex, usageIndex, exampleIndex) {
      const index = `${tenseIndex}-${usageIndex}-${exampleIndex}`;
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const recorder = new MediaRecorder(stream);
        const chunks = [];

        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
          try {
            // ì•ˆë“œë¡œì´ë“œ í˜¸í™˜ì„±ì„ ìœ„í•´ audio/ogg í˜•ì‹ ì‚¬ìš©
            const blob = new Blob(chunks, { type: 'audio/ogg; codecs=opus' });
            const audioElement = document.getElementById(`audio-${index}`);
            if (audioElement) {
              audioElement.src = URL.createObjectURL(blob);
              audioBlobs[index] = blob;
              document.getElementById(`check-${index}`).innerText = 'âœ…';
            }
            
            // ìŠ¤íŠ¸ë¦¼ íŠ¸ë™ ì •ë¦¬
            stream.getTracks().forEach(track => track.stop());
          } catch (error) {
            showError('ë…¹ìŒ ì²˜ë¦¬ ì˜¤ë¥˜: ' + error.message);
          }
        };

        mediaRecorders[index] = recorder;
        recorder.start();
      } catch (error) {
        showError('ë§ˆì´í¬ ì ‘ê·¼ ì˜¤ë¥˜: ' + error.message);
      }
    }

    function stopRecording(tenseIndex, usageIndex, exampleIndex) {
      const index = `${tenseIndex}-${usageIndex}-${exampleIndex}`;
      if (mediaRecorders[index] && mediaRecorders[index].state !== 'inactive') {
        mediaRecorders[index].stop();
      }
    }

    function toggle(id) {
      try {
        const el = document.getElementById(id);
        if (el) {
          el.classList.toggle('hidden');
        }
      } catch (error) {
        showError('í† ê¸€ ì˜¤ë¥˜: ' + error.message);
      }
    }

    function downloadAllRecordings() {
      try {
        const zip = new JSZip();
        let hasRecordings = false;
        
        Object.keys(audioBlobs).forEach(key => {
          if (audioBlobs[key]) {
            const [t, u, e] = key.split('-');
            const tense = grammarData[t].tense.replace(/ /g, '_');
            // ì•ˆë“œë¡œì´ë“œ í˜¸í™˜ì„±ì„ ìœ„í•´ .ogg í™•ì¥ì ì‚¬ìš©
            const filename = `${tense}_example_${parseInt(e)+1}.ogg`;
            zip.file(filename, audioBlobs[key]);
            hasRecordings = true;
          }
        });
        
        if (hasRecordings) {
          zip.generateAsync({ type: 'blob' }).then(content => {
            try {
              saveAs(content, 'english_tenses_recordings.zip');
            } catch (error) {
              showError('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
          });
        } else {
          alert('ë‹¤ìš´ë¡œë“œí•  ë…¹ìŒ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        showError('ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬ ì˜¤ë¥˜: ' + error.message);
      }
    }
  </script>
</body>
</html>